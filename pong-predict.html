<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PongPredictâ„¢</title>
    <style>
        body {
            display: flex;
            height: 100vh;
            margin: 0;
            background-color: black;
            color: white;
        }
        #left, #right {
            width: 50%;
            height: 100%;
        }
        #left {
            background-color: black;
        }
        #right {
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: #111;
        }
        canvas {
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>

<div id="left">
    <canvas id="pongCanvas"></canvas>
</div>
<div id="right">
    <canvas id="predictionCanvas"></canvas>
</div>

<script>
    const pongCanvas = document.getElementById('pongCanvas');
    const predictionCanvas = document.getElementById('predictionCanvas');
    const ctx = pongCanvas.getContext('2d');
    const predCtx = predictionCanvas.getContext('2d');

    pongCanvas.width = 600;
    pongCanvas.height = 400;
    predictionCanvas.width = 600;
    predictionCanvas.height = 400;

    let ballX = pongCanvas.width / 2;
    let ballY = pongCanvas.height / 2;
    let ballSpeedX = 2;  // Slower ball speed
    let ballSpeedY = 2;  // Slower ball speed
    const paddleWidth = 10;
    const paddleHeight = 100;
    let playerY = pongCanvas.height / 2 - paddleHeight / 2;
    let aiY = pongCanvas.height / 2 - paddleHeight / 2;
    const playerSpeed = 4;  // Slower player speed
    const aiSpeed = 1.5;  // Slower AI speed, reduced from before
    let playerScore = 0;
    let aiScore = 0;
    let gameStarted = false;

    // Key press events for controlling player paddle
    let upPressed = false;
    let downPressed = false;

    // Event listener to start the game on click
    document.addEventListener("click", startGame);

    function startGame() {
        if (!gameStarted) {
            gameStarted = true;
            gameLoop();
        }
    }

    function gameLoop() {
        updateGame();
        drawGame();
        predictFuture();
        if (gameStarted) {
            requestAnimationFrame(gameLoop);
        }
    }

    function updateGame() {
        // Ball movement
        ballX += ballSpeedX;
        ballY += ballSpeedY;

        // Ball bounce off top/bottom walls
        if (ballY <= 0 || ballY >= pongCanvas.height) ballSpeedY = -ballSpeedY;

        // Ball bounce off paddles
        if (ballX <= paddleWidth && ballY > playerY && ballY < playerY + paddleHeight) {
            // Randomize ball direction and velocity after hitting player paddle
            ballSpeedX = -ballSpeedX;
            let randomAngle = Math.random() * 1.5 + 0.5;  // Random angle to make it more unpredictable
            ballSpeedY = Math.random() * 2 * randomAngle - randomAngle; // Randomize Y speed to add more variation
            ballSpeedX = ballSpeedX * randomAngle; // Increase the velocity a bit
        }

        if (ballX >= pongCanvas.width - paddleWidth && ballY > aiY && ballY < aiY + paddleHeight) {
            // Randomize ball direction and velocity after hitting AI paddle
            ballSpeedX = -ballSpeedX;
            let randomAngle = Math.random() * 1.5 + 0.5;  // Random angle to make it more unpredictable
            ballSpeedY = Math.random() * 2 * randomAngle - randomAngle; // Randomize Y speed to add more variation
            ballSpeedX = ballSpeedX * randomAngle; // Increase the velocity a bit
        }

        // Ball out of bounds
        if (ballX <= 0) {
            aiScore++;
            resetBall();
        }
        if (ballX >= pongCanvas.width) {
            playerScore++;
            resetBall();
        }

        // AI movement
        if (aiY + paddleHeight / 2 < ballY) aiY += aiSpeed;
        if (aiY + paddleHeight / 2 > ballY) aiY -= aiSpeed;

        // Player movement
        if (upPressed && playerY > 0) playerY -= playerSpeed;
        if (downPressed && playerY < pongCanvas.height - paddleHeight) playerY += playerSpeed;
    }

    function drawGame() {
        ctx.clearRect(0, 0, pongCanvas.width, pongCanvas.height);

        // Draw bounding box
        ctx.strokeStyle = 'white';
        ctx.strokeRect(0, 0, pongCanvas.width, pongCanvas.height);

        // Draw paddles
        ctx.fillStyle = 'white';
        ctx.fillRect(0, playerY, paddleWidth, paddleHeight);  // Player paddle
        ctx.fillRect(pongCanvas.width - paddleWidth, aiY, paddleWidth, paddleHeight);  // AI paddle

        // Draw square ball
        ctx.fillStyle = 'white';
        ctx.fillRect(ballX, ballY, 15, 15);  // Square ball (15x15 px)

        // Draw score
        ctx.font = '30px Courier New';
        ctx.fillText(playerScore, pongCanvas.width / 4, 50);
        ctx.fillText(aiScore, pongCanvas.width - pongCanvas.width / 4, 50);
    }

    // Predict where ball, paddles, and score will be in 5 seconds (300 frames)
    function predictFuture() {
        predCtx.clearRect(0, 0, predictionCanvas.width, predictionCanvas.height);

        // Apply VHS distortion effect (flicker and noise)
        if (Math.random() < 0.02) {
            predCtx.fillStyle = 'black';
            predCtx.fillRect(0, 0, predictionCanvas.width, predictionCanvas.height);
        }

        // Predict the future ball position (simulate 300 frames for 5 seconds of movement)
        let predictedBallX = ballX;
        let predictedBallY = ballY;
        let predictedBallSpeedX = ballSpeedX;
        let predictedBallSpeedY = ballSpeedY;

        let predictedPlayerY = playerY;
        let predictedAiY = aiY;

        for (let i = 0; i < 300; i++) {  // Simulate 5 seconds of movement (300 frames at 60fps)
            predictedBallX += predictedBallSpeedX;
            predictedBallY += predictedBallSpeedY;

            // Ball bounce off top/bottom walls
            if (predictedBallY <= 0 || predictedBallY >= pongCanvas.height) predictedBallSpeedY = -predictedBallSpeedY;

            // Ball bounce off paddles
            if (predictedBallX <= paddleWidth && predictedBallY > predictedPlayerY && predictedBallY < predictedPlayerY + paddleHeight) {
                predictedBallSpeedX = -predictedBallSpeedX;
            }
            if (predictedBallX >= pongCanvas.width - paddleWidth && predictedBallY > predictedAiY && predictedBallY < predictedAiY + paddleHeight) {
                predictedBallSpeedX = -predictedBallSpeedX;
            }

            // AI movement prediction (adjusted to be less perfect)
            if (predictedAiY + paddleHeight / 2 < predictedBallY) predictedAiY += aiSpeed * 0.75;  // Slower AI movement
            if (predictedAiY + paddleHeight / 2 > predictedBallY) predictedAiY -= aiSpeed * 0.75;  // Slower AI movement

            // Player movement prediction (assuming they move upwards or downwards)
            if (upPressed && predictedPlayerY > 0) predictedPlayerY -= playerSpeed;
            if (downPressed && predictedPlayerY < pongCanvas.height - paddleHeight) predictedPlayerY += playerSpeed;
        }

        // Draw predicted ball (visual prediction)
        predCtx.fillStyle = 'rgba(255, 255, 255, 0.5)';
        predCtx.fillRect(predictedBallX, predictedBallY, 15, 15);  // Predicted square ball (15x15 px)

        // Draw predicted player and AI paddles (visual prediction)
        predCtx.fillRect(0, predictedPlayerY, paddleWidth, paddleHeight);  // Predicted player paddle
        predCtx.fillRect(predictionCanvas.width - paddleWidth, predictedAiY, paddleWidth, paddleHeight);  // Predicted AI paddle

        // Predict score changes visually
        let predictedPlayerScore = playerScore;
        let predictedAiScore = aiScore;
        if (predictedBallX <= 0) predictedAiScore++;
        if (predictedBallX >= pongCanvas.width) predictedPlayerScore++;

        // Display the predicted score (visually)
        predCtx.font = '30px Courier New';
        predCtx.fillText(predictedPlayerScore, predictionCanvas.width / 4, 50);
        predCtx.fillText(predictedAiScore, predictionCanvas.width - predictionCanvas.width / 4, 50);
    }

    // Handle paddle controls
    document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowUp') upPressed = true;
        if (e.key === 'ArrowDown') downPressed = true;
    });

    document.addEventListener('keyup', (e) => {
        if (e.key === 'ArrowUp') upPressed = false;
        if (e.key === 'ArrowDown') downPressed = false;
    });

    // Reset ball to center
    function resetBall() {
        ballX = pongCanvas.width / 2;
        ballY = pongCanvas.height / 2;
        ballSpeedX = -ballSpeedX;
        ballSpeedY = 2 * (Math.random() < 0.5 ? 1 : -1);
    }
</script>
</body>
</html>
